"use strict";(globalThis["webpackChunkideahut_quasar_template"]=globalThis["webpackChunkideahut_quasar_template"]||[]).push([[373],{5373:(e,a,t)=>{t.r(a),t.d(a,{default:()=>S});var l=t(1758),n=t(8790);const i={class:"full-width row flex-center text-accent q-gutter-sm"},o={class:"text-subtitle2"},s={class:"text-caption"};function r(e,a,t,r,d,c){const g=(0,l.g2)("q-space"),p=(0,l.g2)("q-badge"),m=(0,l.g2)("q-tooltip"),u=(0,l.g2)("q-btn"),b=(0,l.g2)("q-icon"),f=(0,l.g2)("q-inner-loading"),h=(0,l.g2)("q-input"),y=(0,l.g2)("q-table"),_=(0,l.g2)("Search"),v=(0,l.g2)("q-dialog"),k=(0,l.g2)("View");return(0,l.uX)(),(0,l.CE)(l.FK,null,[(0,l.bF)(y,{class:"table-sticky-header q-ma-sm",rows:r.table.rows,columns:r.table.columns,"visible-columns":r.table.visibles,loading:r.table.loading,selection:"single",pagination:r.table.pagination,"onUpdate:pagination":a[1]||(a[1]=e=>r.table.pagination=e),dense:e.$q.screen.lt.md,"no-data-label":e.$t("error.data_not_available"),"rows-per-page-label":" ","selected-rows-label":e=>{},"rows-per-page-options":[20,40,60,80,100,120,140,160,180,200],"binary-state-sort":"",separator:"cell",onRequest:c.do_request,bordered:""},{top:(0,l.k6)((()=>[(0,l.bF)(g),(0,l.bF)(u,{glossy:"",round:"",dense:"",class:"q-ma-none q-ml-md",color:"deep-orange",icon:"search",onClick:c.on_search_click},{default:(0,l.k6)((()=>[r.search.empty?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(p,{key:0,class:"led-green",floating:""})),(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.$t("label.search")),1)])),_:1})])),_:1},8,["onClick"]),(0,l.bF)(u,{glossy:"",round:"",dense:"",class:"q-ma-none q-ml-md",color:"indigo",icon:"refresh",loading:r.table.loading,onClick:c.on_refresh_click},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.$t("label.refresh")),1)])),_:1})])),_:1},8,["loading","onClick"])])),"no-data":(0,l.k6)((({message:e})=>[(0,l.Lk)("div",i,[(0,l.bF)(b,{size:"2em",name:"block"}),(0,l.Lk)("span",o,(0,n.v_)(e),1)])])),loading:(0,l.k6)((()=>[(0,l.bF)(f,{showing:"",color:"primary"})])),"body-selection":(0,l.k6)((a=>[(0,l.bF)(u,{glossy:"",round:"",dense:"",size:"sm",class:"q-ma-none q-ml-xs q-mr-sm",color:"deep-purple",icon:"visibility",onClick:e=>c.on_view_click(a)},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,n.v_)(e.$t("label.view")),1)])),_:1})])),_:2},1032,["onClick"])])),pagination:(0,l.k6)((e=>[e.pagesNumber>2?((0,l.uX)(),(0,l.Wv)(u,{key:0,glossy:"",size:"sm",icon:"first_page",color:"grey-8",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.firstPage},null,8,["disable","onClick"])):(0,l.Q3)("",!0),(0,l.bF)(u,{glossy:"",size:"sm",icon:"chevron_left",color:"grey-8",class:"q-ml-sm q-mr-xs",round:"",dense:"",flat:"",disable:e.isFirstPage,onClick:e.prevPage},null,8,["disable","onClick"]),(0,l.bF)(h,{dense:"",borderless:"",type:"number","input-class":"text-center q-ml-xs q-mr-xs","input-style":"max-width: 60px;",modelValue:r.table.pagination.page,"onUpdate:modelValue":[a[0]||(a[0]=e=>r.table.pagination.page=e),c.on_page_changed]},(0,l.eX)({_:2},[!0===r.table.pagination.count?{name:"append",fn:(0,l.k6)((()=>[(0,l.Lk)("span",s," / "+(0,n.v_)(e.pagesNumber),1)])),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"]),(0,l.bF)(u,{glossy:"",size:"sm",icon:"chevron_right",color:"grey-8",class:"q-ml-sm q-mr-sm",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.nextPage},null,8,["disable","onClick"]),e.pagesNumber>2&&!0===r.table.pagination.count?((0,l.uX)(),(0,l.Wv)(u,{key:1,glossy:"",size:"sm",icon:"last_page",color:"grey-8",round:"",dense:"",flat:"",disable:e.isLastPage,onClick:e.lastPage},null,8,["disable","onClick"])):(0,l.Q3)("",!0)])),_:1},8,["rows","columns","visible-columns","loading","pagination","dense","no-data-label","onRequest"]),(0,l.bF)(v,{modelValue:r.dialog.search.show,"onUpdate:modelValue":a[2]||(a[2]=e=>r.dialog.search.show=e),persistent:"","transition-show":"slide-down","transition-hide":"none"},{default:(0,l.k6)((()=>[(0,l.bF)(_,{parameters:r.dialog.search.parameters,onClose:c.on_close_dialog_search},null,8,["parameters","onClose"])])),_:1},8,["modelValue"]),(0,l.bF)(v,{modelValue:r.dialog.view.show,"onUpdate:modelValue":a[3]||(a[3]=e=>r.dialog.view.show=e),persistent:"","transition-show":"slide-down","transition-hide":"none"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{parameters:r.dialog.view.parameters},null,8,["parameters"])])),_:1},8,["modelValue"])],64)}t(239);var d=t(8734),c=t(9928),g=t(526);const p={components:{Search:(0,l.$V)((()=>Promise.all([t.e(121),t.e(918)]).then(t.bind(t,6918)))),View:(0,l.$V)((()=>Promise.all([t.e(121),t.e(226)]).then(t.bind(t,9226))))},setup(){return{util:c.Z,handler:(0,d.KR)(null),manager:(0,d.KR)(null),type:(0,d.KR)(null),info:(0,d.KR)({}),definition:{default:{visibles:[],columns:[]},entity:{visibles:[],columns:[]}},table:(0,d.KR)({rows:[],visibles:[],columns:[],pagination:{page:1,rowsPerPage:20,sortBy:"entry",descending:!0,count:!1},loading:!1}),search:(0,d.KR)({filters:[],empty:!0}),dialog:(0,d.KR)({search:{show:!1,parameters:null},view:{show:!1,parameters:null}})}},created(){let e=this;e.definition.default={visibles:["id","action","replica","auditor","info","type","content","entry"],columns:[{name:"entry",label:e.$t("label.entry"),field:"entry",align:"left",timestamp:!0,pattern:"YYYY-MM-DD HH:mm:ss",sortable:!0,format:function(e,a){return c.Z.format.date(c.Z.getFieldValue("entry",a),{format:"YYYY-MM-DD HH:mm:ss"})}},{name:"id",label:e.$t("label.id"),field:"id",align:"left",type:"java.lang.String",sortable:!0},{name:"action",label:e.$t("label.action"),field:"action",align:"left",type:"java.lang.String",sortable:!0},{name:"replica",label:e.$t("label.replica"),field:"replica",align:"left",type:"java.lang.Integer",sortable:!0},{name:"auditor",label:e.$t("label.auditor"),field:"auditor",align:"left",type:"java.lang.String",sortable:!0},{name:"info",label:e.$t("label.info"),field:"info",align:"left",type:"java.lang.String",sortable:!0},{name:"type",label:e.$t("label.type"),field:"type",align:"left",type:"java.lang.String",sortable:!0},{name:"content",label:e.$t("label.content"),field:"content",align:"left",type:"java.lang.String",sortable:!0}]},e.definition.entity={visibles:["action","replica","auditor","entry"],columns:[{name:"entry",label:e.$t("label.entry"),field:"entry",align:"left",timestamp:!0,pattern:"YYYY-MM-DD HH:mm:ss",sortable:!0,format:function(e,a){return c.Z.format.date(c.Z.getFieldValue("entry",a),{format:"YYYY-MM-DD HH:mm:ss"})}},{name:"action",label:e.$t("label.action"),field:"action",align:"left",type:"java.lang.String",sortable:!0},{name:"replica",label:e.$t("label.replica"),field:"replica",align:"left",type:"java.lang.Integer",sortable:!0},{name:"auditor",label:e.$t("label.auditor"),field:"auditor",align:"left",type:"java.lang.String",sortable:!0},{name:"info",label:e.$t("label.info"),field:"info",align:"left",type:"java.lang.String",sortable:!0}]},e.do_init()},beforeUpdate(){this.do_init()},methods:{get_pagination(e){let a=this,t=e?.pagination?e.pagination:a.table.pagination;return t?(a.table.pagination=t,t):a.table.pagination},is_field_visible(e){return"[B"!==e.type&&(!0!==e.lob&&("java.lang.String"!==e.type||e.length<=255))},create_search_filters(){let e=this,a=e.table.columns,t=e.table.visibles;e.search={filters:[],empty:!0};for(const l of a)if(t.includes(l.name)){let a=!0,t={name:l.name,label:l.label,timestamp:l.timestamp,pattern:l.pattern};!0===l.timestamp?(t.type="datetime",t.condition="BETWEEN",c.Z.isString(l.format)&&(t.pattern=col)):"java.lang.String"===l.type?(t.type=l.length>100?"words":"text",t.condition="ANY_LIKE"):"java.lang.Character"===l.type?(t.type="text",t.condition="EQUAL"):"java.time.LocalDateTime"===l.type?(t.type="datetime",t.pattern=l.format,t.condition="BETWEEN"):"java.lang.Integer"===l.type||"java.lang.Long"===l.type?(t.type="number",t.condition="EQUAL"):a=!1,a&&e.search.filters.push(t)}},do_init(){let e=this,a=e.$route.query.handler,t=e.$route.query.manager,l=e.$route.query.type;if(a===e.handler&&t===e.manager&&l===e.type)return;let n="YYYY-MM-DD HH:mm:ss";e.handler=a,e.manager=t,e.type=l,"_"!==e.type?(e.table.columns=[...e.definition.entity.columns],e.table.visibles=[...e.definition.entity.visibles],g.F.call({path:"/audit/info",params:{handler:e.handler,type:e.type,manager:e.manager},onSuccess(a){if(c.Z.isObject(a)){e.info=a;for(const a of e.info.fields){e.is_field_visible(a)&&e.table.visibles.push("content."+a.name);let t=!0,l={name:"content."+a.name,label:a.label,field:"content",align:"left",type:a.type,sortable:!0,format:function(e){let t=c.Z.isObject(e)?c.Z.getFieldValue(a.name,e):e;return t=c.Z.isObject(t)?JSON.stringify(t):t,t}};c.Z.isString(a.format)&&(l.pattern=a.format),!0===e.info.isSoftDelete&&"deletedOn"===a.name?(l.timestamp=!0,l.pattern=c.Z.isString(a.format)?a.format:n,l.format=function(e){try{return c.Z.format.date(c.Z.getFieldValue("deletedOn",e),{format:n})}catch(a){return e}}):!0===e.info.isAudit&&("createdOn"===a.name?(l.timestamp=!0,l.pattern=c.Z.isString(a.format)?a.format:n,l.format=function(e){try{return c.Z.format.date(c.Z.getFieldValue("createdOn",e),{format:n})}catch(a){return e}}):"updatedOn"===a.name?(l.timestamp=!0,l.pattern=c.Z.isString(a.format)?a.format:n,l.format=function(e){try{return c.Z.format.date(c.Z.getFieldValue("updatedOn",e),{format:n})}catch(a){return e}}):"createdBy"!==a.name&&"updatedBy"!==a.name||(t=!1)),t&&e.table.columns.push(l)}e.create_search_filters(),e.do_request()}}})):(e.table.columns=[...e.definition.default.columns],e.table.visibles=[...e.definition.default.visibles],e.create_search_filters(),e.do_request())},do_request(e){let a=this,{page:t,rowsPerPage:l,sortBy:n,descending:i}=a.get_pagination(e),o=[],s=a.search;if(!s.empty){let e,a;for(const t of s.filters)if(e=c.Z.isDefined(t.value)?t.value:"",""!==e)if("BETWEEN"===t.condition)a=c.Z.isDefined(t.value2)?t.value2:"",""!==a&&("datetime"===t.type&&!0===t.timestamp&&(e=c.Z.parse.epoch(e,{format:t.pattern||null}),a=c.Z.parse.epoch(a,{format:t.pattern||null})),o.push({field:t.name,condition:t.condition,values:[e,a]}));else{"datetime"===t.type&&!0===t.timestamp&&(e=c.Z.parse.epoch(e,{format:t.pattern||null}));let a=t.or;if(c.Z.isString[a]&&(a=[a]),a=c.Z.isArray(a)?a:[],a.length){let l={logical:"and",filters:[]};for(let n=0;n<a.length;n++)l.filters.push({field:a[n],logical:0===n?"and":"or",condition:t.condition,value:e});o.push(l)}else o.push({field:t.name,condition:t.condition,value:e})}}let r={page:{index:t,size:l,count:!0===a.table.pagination.count},filters:o,manager:a.manager};"_"!==a.type&&(r.entity=a.type),n&&(r.orders=[(i?"-":"")+n]),a.table.loading=!0,g.F.call({path:"/audit/list",method:"post",params:{handler:a.handler},data:r,onFinish(){a.table.loading=!1},onSuccess(e){if(c.Z.isObject(e)){a.table.rows=c.Z.isArray(e.data)?e.data:[];let t=a.table.pagination;if(t.page=e.index,t.rowsPerPage=e.size,c.Z.isNumber(e.records))t.rowsNumber=e.records;else{let l=e.index*e.size;a.table.rows.length!==e.size?t.rowsNumber=l:t.rowsNumber=l+1}}}})},on_search_click(){let e=this;e.dialog.search={show:!0,parameters:{filters:e.search.filters}}},on_close_dialog_search(e){let a=this;if(c.Z.isArray(e)){let t=a.search;t.filters=e,t.empty=!0;for(const e of t.filters){let a=c.Z.isDefined(e.value)?e.value:"",l=c.Z.isDefined(e.value2)?e.value2:"";if(""!==a||""!==l){t.empty=!1;break}}a.dialog.search={show:!1,parameters:null},a.table.pagination.page=1,a.do_request({pagination:a.table.pagination})}},on_refresh_click(){let e=this;e.table.rows?.length||e.table.pagination.page>1&&(e.table.pagination.page=1),e.do_request({pagination:e.table.pagination})},on_view_click(e){let a=this;a.dialog.view={show:!0,parameters:{scope:e,columns:a.table.columns}}},on_page_changed(){let e=this,a=+e.table.pagination.page;!isNaN(a)&&a>0&&e.do_request({pagination:e.table.pagination})}}};var m=t(2807),u=t(3621),b=t(1173),f=t(9001),h=t(4031),y=t(8151),_=t(4609),v=t(4264),k=t(8020),w=t(7201),q=t(8582),Z=t.n(q);const F=(0,m.A)(p,[["render",r]]),S=F;Z()(p,"components",{QTable:u.A,QSpace:b.A,QBtn:f.A,QBadge:h.A,QTooltip:y.A,QIcon:_.A,QInnerLoading:v.A,QInput:k.A,QDialog:w.A})}}]);